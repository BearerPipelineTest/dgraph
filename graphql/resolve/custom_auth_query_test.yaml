- name : "custom DQL query with @groupby"
  gqlquery: |
    query{
      queryIssueGroupedByOwner {
        groupby {
          owner
          count
        } 
      }
    }
  jwtvar:
    ROLE: "ADMIN"
    USER: "user1"
  dgquery: |-
    query {
      queryIssueGroupedByOwner(func: uid(GroupedIssueMapQRoot)) @groupby(owner : Issue.owner) {
        count(uid)
      }
      GroupedIssueMapQRoot as var(func: uid(Issue_1)) @filter(uid(Issue_Auth2))
      Issue_1 as var(func: type(Issue))
      Issue_Auth2 as var(func: uid(Issue_1)) @cascade {
        Issue.owner : Issue.owner @filter(eq(User.username, "user1"))
      }
    }

- name : "custom DQL query with var block satisfying RBAC @auth rules"
  gqlquery: |
    query{
      queryIssueSortedByOwnerAge {
        id
        msg
        random
      }
    }
  jwtvar:
    ROLE: "ADMIN"
    USER: "user1"
  dgquery: |-
    query {
      var(func: uid(IssueRoot)) {
        Issue.owner {
          age as User.age
        }
      }
      IssueRoot as var(func: uid(Issue_1)) @filter(uid(Issue_Auth2))
      Issue_1 as var(func: type(Issue))
      Issue_Auth2 as var(func: uid(Issue_1)) @cascade {
        Issue.owner : Issue.owner @filter(eq(User.username, "user1"))
      }
      queryIssueSortedByOwnerAge(func: uid(age), orderdesc: age) {
        id : uid
        msg : Issue.msg
        random : Issue.random
      }
    }

- name : "custom DQL query with var block failing RBAC @auth rules"
  gqlquery: |
    query{
      queryIssueSortedByOwnerAge {
        id
        msg
        random
      }
    }
  jwtvar:
    ROLE: "USER"
    USER: "user1"
  dgquery: |-
    query {
      var() {
        Issue.owner {
          age as User.age
        }
      }
      queryIssueSortedByOwnerAge(func: uid(age), orderdesc: age) {
        id : uid
        msg : Issue.msg
        random : Issue.random
      }
    }
- name : "Auth Rules with deep filter"
  gqlquery: |
    query {
      queryUsers {
        username
        tickets {
          id
          title
        }
      }
    }
  jwtvar:
    USER: "user1"
  dgquery: |-
    query {
      queryUsers(func: uid(UserRoot)) {
        username : User.username
        tickets : User.tickets @filter(uid(Ticket_1)) {
          id : uid
          title : Ticket.title
        }
      }
      UserRoot as var(func: uid(User_4))
      User_4 as var(func: type(User))
      var(func: uid(UserRoot)) {
        Ticket_2 as User.tickets
      }
      Ticket_1 as var(func: uid(Ticket_2)) @filter(uid(Ticket_Auth3))
      Ticket_Auth3 as var(func: uid(Ticket_2)) @cascade {
        Ticket.onColumn : Ticket.onColumn {
          Column.inProject : Column.inProject {
            Project.roles : Project.roles @filter(eq(Role.permission, "VIEW")) {
              Role.assignedTo : Role.assignedTo @filter(eq(User.username, "user1"))
            }
          }
        }
      }
    }

- name : "Auth rules with deep filter failed"
  gqlquery: |
    query{
      queryUsers{
        username
        tickets {
          id
          title
        }
      }
    }
  dgquery: |-
    query {
      queryUsers(func: uid(UserRoot)) {
        username : User.username
      }
      UserRoot as var(func: uid(User_3))
      User_3 as var(func: type(User))
    }